<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: July 15, 2024 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.19668da90268b69d9fc3810db8d45927.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  

  <meta name="google-site-verification" content="google-site-verification=AHp2gxXRopBj-zmhkASy020QAqZuWGxuJxV69CRTH5w" />

























  
  
  






  <meta name="author" content="Adrián Sager La Ganga" />





  

<meta name="description" content="What if we could systematically quantify how sustainable a reaction is?
In this project (my master&rsquo;s thesis at EPFL) I explored how useful it would be if we quantified sustainability as how likely it is that a reaction is sustainable." />



<link rel="alternate" hreflang="en-us" href="https://sager611.github.io/project/epfl-master-thesis/" />
<link rel="canonical" href="https://sager611.github.io/project/epfl-master-thesis/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu4c33f529594115c732c21d26133ca9c2_321136_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu4c33f529594115c732c21d26133ca9c2_321136_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@wowchemy" />
  <meta property="twitter:creator" content="@wowchemy" />
<meta property="twitter:image" content="https://sager611.github.io/project/epfl-master-thesis/featured.png" />
<meta property="og:site_name" content="Adrián Sager La Ganga" />
<meta property="og:url" content="https://sager611.github.io/project/epfl-master-thesis/" />
<meta property="og:title" content="UQ-based metrics for chemical sustainability | Adrián Sager La Ganga" />
<meta property="og:description" content="What if we could systematically quantify how sustainable a reaction is?
In this project (my master&rsquo;s thesis at EPFL) I explored how useful it would be if we quantified sustainability as how likely it is that a reaction is sustainable." /><meta property="og:image" content="https://sager611.github.io/project/epfl-master-thesis/featured.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2023-02-25T16:37:09&#43;01:00"
    />
  
  
    <meta property="article:modified_time" content="2023-02-25T16:37:09&#43;01:00">
  






    









<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://sager611.github.io/project/epfl-master-thesis/"
  },
  "headline": "UQ-based metrics for chemical sustainability",
  
  "image": [
    "https://sager611.github.io/project/epfl-master-thesis/featured.png"
  ],
  
  "datePublished": "2023-02-25T16:37:09+01:00",
  "dateModified": "2023-02-25T16:37:09+01:00",
  
  "author": {
    "@type": "Person",
    "name": "Adrián Sager La Ganga"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Adrián Sager La Ganga",
    "logo": {
      "@type": "ImageObject",
      "url": "https://sager611.github.io/media/icon_hu4c33f529594115c732c21d26133ca9c2_321136_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "What if we could systematically quantify how sustainable a reaction is?\nIn this project (my master\u0026rsquo;s thesis at EPFL) I explored how useful it would be if we quantified sustainability as how likely it is that a reaction is sustainable."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>UQ-based metrics for chemical sustainability | Adrián Sager La Ganga</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="bb373e34aa74a9e0f96d626986715a37" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.eb494022c3035bcfc7233efd58d079d7.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Adrián Sager La Ganga</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Adrián Sager La Ganga</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/post"><span>Blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/project"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/uploads/resume_2.pdf"><span>Resume</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article article-project">

  






















  
  


<div class="article-container pt-3">
  <h1>UQ-based metrics for chemical sustainability</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Feb 25, 2023
  </span>
  

  

  

  
  
  
  

  
  

</div>

  




<div class="btn-links mb-3">
  
  








  
    
  



<a class="btn btn-outline-primary btn-page-header" href="/uploads/EPFL_Master_Thesis.pdf" target="_blank" rel="noopener">
  PDF
</a>

















</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 395px;">
  <div style="position: relative">
    <img src="/project/epfl-master-thesis/featured_hu3d2a603485620d1fa19c8debcbfb6843_128548_720x2500_fit_q75_h2_lanczos_3.webp" width="720" height="395" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>
  <i class="fas fa-leaf  pr-1 fa-fw"></i> What if we could systematically quantify <em>how</em> sustainable a reaction is?</p>
<p>In this project (my master&rsquo;s thesis at EPFL) I explored how useful it would be if we quantified sustainability as <em>how likely</em> it is that a reaction is sustainable. This likelihood would then be computed by employing <strong>uncertainty quantification (UQ)</strong> on some AI model&rsquo;s prediction.</p>
<p>The main contribution of the project is an <strong>extensible toolkit</strong> with sustainability metrics based on AI model predictions.</p>
<p>In this page I collect some of my thoughts derived from this project.</p>
<p><a href="/uploads/EPFL_Master_Thesis.pdf" target="_blank">You can read the full report here.</a></p>
<div class="alert alert-note">
  <div>
    This work was created and funded as part of the <a href="https://nccr-catalysis.ch/news/recipients-of-2022-young-talents-fellowship/" target="_blank" rel="noopener">NCCR Catalysis Young Talents Fellowship</a>, a National Centre of Competence in Research funded by the Swiss National Science Foundation.
  </div>
</div>


<details class="toc-inpage d-print-none  " open>
  <summary class="font-weight-bold">Table of Contents</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ai-metric-definition">AI-metric definition</a>
      <ul>
        <li><a href="#modelling-uncertainty">Modelling uncertainty</a></li>
        <li><a href="#quantifying-ai-metrics">Quantifying AI-metrics</a></li>
      </ul>
    </li>
    <li><a href="#validating-ai-metrics">Validating AI-metrics</a></li>
    <li><a href="#dont-pay-attention-to-the-_attention_-">Don&rsquo;t pay attention to the <em>attention</em> &hellip;</a></li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
  </ul>
</nav>
</details>

<h2 id="ai-metric-definition">AI-metric definition</h2>
<p>Let&rsquo;s say a chemical reaction can be one of 

$\mathcal{C}$ classes, for ex., according to its type: &ldquo;<em>carboxylic acid to acid chloride</em>&rdquo;, &ldquo;<em>translocase-catalyzed</em>&rdquo;, etc.</p>
<p>Some of these classes are sustainable, 

$\mathcal{C}_\text{sust}$, some are not, 

$\mathcal{C}_\text{non-sust}$, and we may have an unrecognized class, 

$\mathcal{C}_\text{unrec}=\{y_\text{unrec}\}$.</p>
<details class="spoiler "  id="spoiler-8">
  <summary>Click to view the reaction type distribution</summary>
  <p><figure  id="figure-in-reality-our-distribution-of-reaction-types-is-hierarchical-but-the-argument-still-applies">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="rxn_class_distr.svg" alt="Reaction classes are divided in multiple levels" loading="lazy" data-zoomable /></div>
  </div><figcaption>
      In reality, our distribution of reaction types is hierarchical, but the argument still applies
    </figcaption></figure></p>
</details>
<p>We can then quantify <em>how likely</em> we <em>expect</em> some reaction 

$\pmb{x}$ to be of some class 

$y\in\mathcal{C}$:</p>


$$ \text{AI-metric}_y := \mathbb{E}_{p(\pmb{\theta}\vert\mathcal{D})}\left[p(y\vert\pmb{x}, \pmb{\theta})\right]\cdot\text{confidence}(\pmb{x}, y) \quad \in [0,1]$$
<p>Where 

$\pmb{\theta}$ are the parameters of our AI model after training it on some dataset 

$\mathcal{D}$.</p>
<p>Note how we are scaling by how <em>confident</em> we are that this expected likelihood is correct. In our case,</p>


$$\text{confidence}(\pmb{x}, y) := 1 - 2\cdot\text{stddev}_{p(\pmb{\theta}\vert\mathcal{D})}\big(p(y\vert\pmb{x}, \pmb{\theta})\big)$$
<p>Which is always in 

$[0,1]$ since probabilities cannot deviate more than 

$1/2$.</p>
<p>But, how do we score how likely our 

$\pmb{x}$ is of <em>any</em> class in 

$\mathcal{C}_\text{sust}$?</p>
<p>
  <i class="fas fa-arrow-right  pr-1 fa-fw"></i> We simply take the maximum over 

$\mathcal{C}_\text{sust}$:</p>


$$\text{AI-metric} := \max_{y\in\mathcal{C}_\text{sust}} \text{AI-metric}_y \quad \in [0, 1] $$
<details class="spoiler " id="spoiler-21">
  <summary>Why not sum over

$\mathcal{C}_\text{sust}$?</summary>
  <p>Formally, we are asking 

$p(\cup_{\mathcal{C}_\text{sust}}y\vert \pmb{x},\mathcal{D})$, which is:


$$ \max_{y\in\mathcal{C}_\text{sust}} p(y\vert\pmb{x},\mathcal{D}) \leq p(\cup_{\mathcal{C}_\text{sust}}y\vert \pmb{x},\mathcal{D}) \leq \sum_{y\in\mathcal{C}_\text{sust}} p(y\vert\pmb{x},\mathcal{D}) $$
    Since we are estimating our metric (see next section) and since some 

$\pmb{x}$ may be of multiple classes, if we sum probabilities we would be overestimating the true value and also our score may end up above 1. <br/>
    It is also crucial that in our case our AI model is <em>single-label</em>, so it is designed to only predict the highest probability class.
  </p>
</details>
<h3 id="modelling-uncertainty">Modelling uncertainty</h3>
<p>Without getting too philosophical, we want to believe that <em>for sure</em> there is some underlying <em>true</em> classification set for an input 

$\pmb{x}$, 

$\mathcal{C}_\text{true} \subseteq \mathcal{C}$, so:</p>


$$
p(y\vert\pmb{x}) = \begin{cases}1 & \text{if }y\in\mathcal{C}_\text{true} \\
0 & \text{o.w.}\end{cases}
$$
<p>Note that (by our philosophy) 

$p(y\vert\pmb{x})$ is equivalent to 

$p(y\vert\pmb{x},\mathcal{D}_\text{all})$ where 

$\mathcal{D}_\text{all}$ is all the knowledge of the universe (quite some information!).</p>
<p>Of course, in reality at best we know:</p>


$$p(y\vert\pmb{x},\mathcal{D}) = \mathbb{E}_{p(\pmb{\theta}\vert\mathcal{D})}\left[ p(y\vert\pmb{x},\pmb{\theta}) \right]$$
<p>For our observed training set 

$\mathcal{D}$.</p>
<p>This means that we are in the presence of two sources of uncertainty<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>:</p>
<ol>
<li><strong>Epistemic</strong> 

$\pmb{\theta}$: due to the limited expresiveness of our model and its optimization procedure.</li>
<li><strong>Aleatoric</strong> 

$\mathcal{D}$: due to noise in our training set (some entries aren&rsquo;t reactions or have a wrong label).</li>
</ol>
<h3 id="quantifying-ai-metrics">Quantifying AI-metrics</h3>
<p>We use efficient <strong>uncertainty quantification (UQ)</strong> techniques to estimate our AI-metric according to the two sources of uncertainty<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>:</p>
<ol>
<li>
<p><strong>Monte Carlo Dropout (MCDropout)</strong> for <strong>epistemic</strong> uncertainty 

$\pmb{\theta}$: We leave our Drouput layers <em>on</em> during inference, so for each forward pass on the same 

$\pmb{x}$ we are effectively sampling different submodels from an ensemble.</p>
</li>
<li>
<p><strong>Test-time data augmentation</strong> for <strong>aleatoric</strong> uncertainty 

$\mathcal{D}$: We augment 

$\pmb{x}$ during inference.</p>
</li>
</ol>
<p>We then have 

$N\times M$ likelihoods 

$p(y\vert\pmb{x}^{(i)}, \pmb{\theta}^{(j)})$ where we sampled our input 

$\pmb{x}^{(1)},\dots,\pmb{x}^{(N)}$ and our model 

$\pmb{\theta}^{(1)},\dots,\pmb{\theta}^{(M)}$. Our AI-metric then simply uses the average and stddev of these values to compute its score.</p>
<p>For example,</p>
<p>















<figure  id="figure-top-5-reaction-types-for-reaction-according-to-the-ai-metric-the-actual-true-types-for-this-reaction-are-in-red-this-is-a-special-reaction-which-can-be-both-enzymatic-and-non-enzymatic">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Top-5 reaction types for reaction according to the AI-metric. The actual true types for this reaction are in red. This is a special reaction which can be both enzymatic and non-enzymatic"
           src="/project/epfl-master-thesis/example_likelihood_uq-1.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Top-5 reaction types for reaction according to the AI-metric. The actual true types for this reaction are in red. This is a special reaction which can be both enzymatic and non-enzymatic
    </figcaption></figure>
</p>
<h2 id="validating-ai-metrics">Validating AI-metrics</h2>
<p>How useful is this metric definition? Is it really able to differentiate reactions 

$\pmb{x}$ in 

$\mathcal{C}_\text{sust}$ from those in 

$\mathcal{C}_\text{non-sust}$?</p>
<p>To answer this, I looked at two opposite scores:</p>
<p>
  <i class="fas fa-leaf  pr-1 fa-fw"></i> <strong>Sustainability score</strong>: 

$\text{AI-metric} := \max_{y\in\mathcal{C}_\text{sust}} \text{AI-metric}_y $</p>
<p>
  <i class="fas fa-industry  pr-1 fa-fw"></i> <strong>Non-sustainability score</strong>: 

$\overline{\text{AI-metric}} := \max_{y\in\mathcal{C}_\text{non-sust}} \text{AI-metric}_y $</p>
<p>In particular, I quantify how likely it is that a reaction is <strong>enzymatic</strong>, since these types of reactions are a classical example of sustainable reactions.</p>
<p>First, I fine-tuned BERT on a training set of reactions in the <em>SMILES</em> text-based format, achiving an overall validation accuracy of 93.95% and macro F1 score of 0.901 when predicting the reaction type.</p>
<p>Then, we can compute 

$\text{AI-metric}$ and 

$\overline{\text{AI-metric}}$ using this BERT model for all reactions in the validation set and plot the results:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="The enzyme metric separates enzymatic from non-sustainable reactions"
           src="/project/epfl-master-thesis/eval_ec_metric_scores.svg"
           loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Clearly, enzymatic reactions cluster in <span style="color:#00b5ecff">blue</span> separately from non-enzymatic ones in <span style="color:#ff0000ff">red</span>.</p>
<p>Around here, our validation discussion of the AI-metric ends, but it would be interesting to study more in depth its applicability, in particular we could carefully design a dataset by artificially introducing aleatoric uncertainty and study how our AI-metric scores change as we increase data noise and as we underfit/overfit our model.</p>
<h2 id="dont-pay-attention-to-the-_attention_-">Don&rsquo;t pay attention to the <em>attention</em> &hellip;</h2>
<p>Of what use is a probabilistic metric if we cannot interpret the results? It&rsquo;d be more appropriate if our toolkit of metrics also contained <strong>AI interpretability tools</strong>.</p>
<p>This is specially important since we may have <em>high confidence</em> in a wrong prediction. For example:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt=""
           src="/project/epfl-master-thesis/missclassified_likelihood.svg"
           loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Our BERT model classifies the reaction as class EC.5, which means that is uses an <a href="https://en.wikipedia.org/wiki/Isomerase" target="_blank" rel="noopener">isomerase</a> enzyme. In reality the reaction is not enzymatic, it is of type 9.3.1 (&quot;<em>carboxylic acid to acid chloride</em>&quot;), and the AI-metric scores it as ~51% likely and confidently to be enzymatic. By our plot from the previous section, we&rsquo;d simply look at this score and blindly accept it as enzymatic.</p>
<p>So what is going on?</p>
<p>We may want to look at what BERT is doing. In particular its attention scores:</p>
<p>















<figure  id="figure-attention-score-matrices-and-sum-of-attention-scores-per-atom-at-the-last-layer">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Attention score matrices and sum of attention scores per atom at the last layer"
           src="/project/epfl-master-thesis/missclassified_att_last_head.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Attention score matrices and sum of attention scores per atom at the last layer
    </figcaption></figure>
</p>
<p>Note how attention indicates that the model attributes attention to the <code>OH</code> and <code>Cl</code> exchange, which is precisely the rule for type 9.3.1. But the model of course does not predict the reaction as that type! What happens is that token embeddings at the last layer do not represent the corresponding token individually, but rather a global property in the text, so attention does not tell us the casual relationship learned between the input atomic structures and the output.</p>
<p>In fact, we should <strong>not</strong> look into <em>attention</em> attribution, but <em>importance</em> attribution, i.e. how each input affected the output.</p>
<p>With the <a href="https://captum.ai/" target="_blank" rel="noopener">Captum</a> Python package we can see this importance attribution through the so-called method of <em>Integrated Gradients</em><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>:</p>
<p>















<figure  id="figure-blue-positive-attribution-red-negative-attribution">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Blue: positive attribution. Red: negative attribution"
           src="/project/epfl-master-thesis/missclassified_importance_attr.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      <span style='color:#00b5ecff'>Blue</span>: positive attribution. <span style='color:#ff0000ff'>Red</span>: negative attribution
    </figcaption></figure>
</p>
<p>So now we see that <code>OH</code> and <code>Cl</code> exchange did not cause the model to predict the reaction type as EC.5, but some other structure.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>To summarize, this toolkit of AI-metrics is useful to automatically select reactions which are likely to be sustainable, but the resulting reactions should always be checked by a chemist expert to make sure that they are indeed sustainable.</p>
<p>We basically want to introduce a framework with sustainability metrics <strong>during the design cycle of molecule discovery</strong>, where our expert is still exploring which reactions may be feasible. This could, in principle, accelerate sustainable decision-making in chemistry.</p>
<p>















<figure  id="figure-scientific-method-applied-to-molecule-discovery-where-we-introduce-our-ai-metrics">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Scientific method applied to molecule discovery, where we introduce our AI-metrics"
           src="/project/epfl-master-thesis/dmta.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Scientific method applied to molecule discovery, where we introduce our AI-metrics
    </figcaption></figure>
</p>
<p>A particular use-case for our toolkit is the <em>multistep retrosynthesis</em> task, where we want to find a path of reactions that can generate a target molecule from some starting molecules.</p>
<p>















<figure  id="figure-example-reaction-path-also-called-_route_-or-_pathway_">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Example reaction path, also called _route_ or _pathway_"
           src="/project/epfl-master-thesis/example_route.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Example reaction path, also called <em>route</em> or <em>pathway</em>
    </figcaption></figure>
</p>
<p>We simply generate <em>many</em> possible reaction paths for some target molecule using <a href="https://github.com/MolecularAI/aizynthfinder" target="_blank" rel="noopener">AiZynthFinder</a> and Monte-Carlo tree search (MCTS)<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</p>
<p>Then, we select the best reaction path according to a weighted sum of our sustainability metrics and an estimation of the monetary cost to carry out the reactions.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /project/epfl-master-thesis/casp-summary_hu36599876e55c22b03b1eeddf42f4d63c_218469_1d2199fd17f64435a10fb586e0f5287e.webp 400w,
               /project/epfl-master-thesis/casp-summary_hu36599876e55c22b03b1eeddf42f4d63c_218469_3b530f4cb0190ba3e970b68047aef17b.webp 760w,
               /project/epfl-master-thesis/casp-summary_hu36599876e55c22b03b1eeddf42f4d63c_218469_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/project/epfl-master-thesis/casp-summary_hu36599876e55c22b03b1eeddf42f4d63c_218469_1d2199fd17f64435a10fb586e0f5287e.webp"
               width="760"
               height="282"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>In this way, the expert can tune trade-offs between sustainability aspects by simply weighting the metrics.</p>
<p>We can do a quick ablation study and see how increasing the input weights on our enzyme AI-metric increases the enzyme AI-metric score, but also the route cost, so there is a trade-off between the two which can be tuned with the weights:</p>
<p>















<figure  id="figure-change-of-sustainability-scores-from-the-baseline-by-changing-the-input-weights">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Change of sustainability scores from the baseline by changing the input weights"
           src="/project/epfl-master-thesis/ablation_study_short.svg"
           loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Change of sustainability scores from the baseline by changing the input weights
    </figcaption></figure>
</p>
<p>This is the end of this little blog, but you can find more details in the <a href="/uploads/EPFL_Master_Thesis.pdf" target="_blank">report.</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Abdar et al. “A review of uncertainty quantification in deep learning: Techniques, applications and challenges”. 2021&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Markert et al. “Chemical representation learning for toxicity prediction”. 2020&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Sundararajan et al. “Axiomatic Attribution for Deep Networks”. 2017&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Segler et al. “Planning chemical syntheses with deep neural networks and symbolic ai”. 2018&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/uq/">UQ</a>
  
  <a class="badge badge-light" href="/tag/nlp/">NLP</a>
  
  <a class="badge badge-light" href="/tag/chemistry/">chemistry</a>
  
  <a class="badge badge-light" href="/tag/sustainability/">sustainability</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fsager611.github.io%2Fproject%2Fepfl-master-thesis%2F&amp;text=UQ-based&#43;metrics&#43;for&#43;chemical&#43;sustainability" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=UQ-based%20metrics%20for%20chemical%20sustainability&amp;body=https%3A%2F%2Fsager611.github.io%2Fproject%2Fepfl-master-thesis%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fsager611.github.io%2Fproject%2Fepfl-master-thesis%2F&amp;title=UQ-based&#43;metrics&#43;for&#43;chemical&#43;sustainability" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://sager611.github.io/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_huf25ee37de6ddf409e42e2d6afaffee68_27976_270x270_fill_q75_lanczos_center.jpeg" alt="Adrián Sager La Ganga"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://sager611.github.io/">Adrián Sager La Ganga</a></h5>
      <h6 class="card-subtitle">Computational Scientist and Engineer</h6>
      <p class="card-text">My current interests include NeSy AI and interpretability in AI.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:adriansagerlaganga@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/Sager611" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://gitlab.com/adriansagerlaganga" target="_blank" rel="noopener">
        <i class="fab fa-gitlab"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/a-sager" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/uploads/resume_2.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















    <div class="project-related-pages content-widget-hr">
      
      

      
      
      

      
      
      

      
      
      
    </div>
  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2024, Adrián Sager. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.b4708d4364577c16ab7001b265a063a4.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":true}</script>



  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.6ab16275cbca742a586c1726e3d94093.js"></script>

























</body>
</html>
